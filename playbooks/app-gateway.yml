---
- name: Validate successful deployment of application
  hosts: localhost
  gather_facts: false
  vars:
     resource_group: "openenv-5x9h7"
     appgw_name: "my-app-gateway"
     backend_pool_name: "my-pool-1"
     health_probe_name: "my-probe-aap"
     
  tasks:
      
    - name: Update Azure Application Gateway with new backend pool, health probe, backend setting, and path rule
      azure_rm_appgateway:
        resource_group: "{{ resource_group }}"
        name: "{{ appgw_name }}"

        backend_address_pools:
          - name: "{{ backend_pool_name }}"
            backend_addresses:
              - fqdn: "{{ backend_fqdn }}"

        probes:
          - name: "{{ health_probe_name }}"
            protocol: Https
            host: "127.0.0.1"
            path: "/"
            interval: 30
            timeout: 30
            unhealthy_threshold: 30

        backend_http_settings_collection:
          - name: "backend-settings-1"
            port: 80
            protocol: Http
            cookie_based_affinity: Disabled
            probe: "{{ health_probe_name }}"

        state: present
